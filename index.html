<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helping Liv not Fail This Shit ðŸ“š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #fff;
        }

        .container {
            width: 100%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 320px;
            transition: margin-left 0.3s ease;
        }
        
        .container.menu-collapsed {
            margin-left: 60px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            width: 100%;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #6b7280;
            font-size: 0.95em;
        }

        .author-credit {
            font-size: 0.8em;
            color: #4b5563;
            margin-top: 5px;
        }

        .stats-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .stat-card {
            background: #111111;
            border: 1px solid #1f2937;
            padding: 15px 25px;
            border-radius: 12px;
            min-width: 140px;
            text-align: center;
        }

        .stat-card strong {
            display: block;
            color: #9ca3af;
            font-size: 0.85em;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .stat-card span {
            color: #3b82f6;
            font-size: 1.5em;
            font-weight: 600;
        }

        .progress-container {
            width: 100%;
            margin-bottom: 30px;
        }

        .progress-label {
            color: #9ca3af;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1f2937;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 350px;
            margin-bottom: 30px;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            border: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
        }

        .card-front {
            background: #111111;
            color: #fff;
        }

        .card-back {
            background: #111111;
            border: 1px solid #3b82f6;
            transform: rotateY(180deg);
            color: #60a5fa;
        }

        .card-content {
            font-size: 1.15em;
            line-height: 1.6;
        }

        .input-container {
            width: 100%;
            margin-bottom: 25px;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1em;
            border: 1px solid #1f2937;
            border-radius: 10px;
            background: #0a0a0a;
            color: #fff;
            transition: all 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: #111111;
        }

        .answer-input::placeholder {
            color: #4b5563;
        }

        .buttons-container {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .btn {
            padding: 12px 24px;
            font-size: 0.95em;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
        }

        .btn-primary {
            background: #3b82f6;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #1f2937;
            border: 1px solid #374151;
        }

        .btn-secondary:hover {
            background: #374151;
        }

        .btn-success {
            background: #059669;
        }

        .btn-success:hover {
            background: #047857;
        }

        .feedback {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.95em;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.correct {
            background: #064e3b;
            color: #34d399;
            border: 1px solid #059669;
        }

        .feedback.incorrect {
            background: #7f1d1d;
            color: #f87171;
            border: 1px solid #dc2626;
        }

        .category-selector {
            margin-bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: center;
            position: relative;
        }

        .custom-dropdown {
            position: relative;
            min-width: 280px;
        }

        .dropdown-selected {
            padding: 15px 45px 15px 20px;
            font-size: 0.95em;
            font-weight: 500;
            border-radius: 12px;
            border: 2px solid #1f2937;
            background: linear-gradient(135deg, #111111, #1a1a1a);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dropdown-selected::after {
            content: 'â–¼';
            color: #3b82f6;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .dropdown-selected:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #1a1a1a, #222222);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        .dropdown-selected:hover::after {
            color: #60a5fa;
            transform: scale(1.1);
        }

        .dropdown-selected.open::after {
            transform: rotate(180deg);
            color: #60a5fa;
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-options.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-option {
            padding: 15px 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            border-bottom: 1px solid #2d2d2d;
        }

        .dropdown-option:last-child {
            border-bottom: none;
        }

        .dropdown-option:hover {
            background: linear-gradient(135deg, #2d2d2d, #3a3a3a);
            color: #60a5fa;
            padding-left: 25px;
        }

        .dropdown-option.selected {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: #fff;
        }

        .dropdown-option.selected:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            padding-left: 20px;
        }

        /* Custom scrollbar for dropdown */
        .dropdown-options::-webkit-scrollbar {
            width: 6px;
        }

        .dropdown-options::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 3px;
        }

        .dropdown-options::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }

        .dropdown-options::-webkit-scrollbar-thumb:hover {
            background: #60a5fa;
        }
        
        /* Side Menu Styles */
        .side-menu {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: #0f0f0f;
            border-right: 1px solid #1f2937;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .side-menu.collapsed {
            transform: translateX(-240px);
        }
        
        .menu-toggle {
            position: absolute;
            right: -40px;
            top: 20px;
            width: 35px;
            height: 35px;
            background: #111111;
            border: 1px solid #1f2937;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #3b82f6;
            font-size: 1.2em;
            z-index: 101;
        }
        
        .menu-toggle:hover {
            background: #1a1a1a;
            border-color: #3b82f6;
            transform: scale(1.05);
        }
        
        .menu-header {
            padding: 25px 20px;
            border-bottom: 1px solid #1f2937;
            background: linear-gradient(135deg, #111111, #1a1a1a);
        }
        
        .menu-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #3b82f6;
            margin-bottom: 5px;
        }
        
        .menu-subtitle {
            font-size: 0.85em;
            color: #6b7280;
        }
        
        .exam-folder {
            margin: 10px;
        }
        
        .exam-header {
            padding: 12px 15px;
            background: #111111;
            border: 1px solid #1f2937;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }
        
        .exam-header:hover {
            background: #1a1a1a;
            border-color: #3b82f6;
        }
        
        .exam-header.active {
            background: linear-gradient(135deg, #1a1a1a, #222222);
            border-color: #3b82f6;
        }
        
        .exam-name {
            color: #fff;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .exam-name::before {
            content: 'ðŸ“š';
        }
        
        .exam-arrow {
            color: #6b7280;
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }
        
        .exam-header.active .exam-arrow {
            transform: rotate(90deg);
            color: #3b82f6;
        }
        
        .chapter-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .chapter-list.open {
            max-height: 2000px;
        }
        
        .chapter-folder {
            margin-left: 15px;
            margin-bottom: 5px;
        }
        
        .chapter-header {
            padding: 10px 15px;
            background: #0a0a0a;
            border: 1px solid #1f2937;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            margin-bottom: 3px;
        }
        
        .chapter-header:hover {
            background: #111111;
            border-color: #374151;
            transform: translateX(3px);
        }
        
        .chapter-header.active {
            background: #1a1a1a;
            border-color: #3b82f6;
        }
        
        .chapter-name {
            color: #9ca3af;
            font-size: 0.9em;
            font-weight: 500;
            flex: 1;
        }
        
        .chapter-count {
            background: #1f2937;
            color: #6b7280;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-right: 8px;
        }
        
        .chapter-arrow {
            color: #4b5563;
            font-size: 0.7em;
            transition: transform 0.3s ease;
        }
        
        .chapter-header.active .chapter-arrow {
            transform: rotate(90deg);
            color: #3b82f6;
        }
        
        .card-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-left: 15px;
        }
        
        .card-list.open {
            max-height: 1500px;
        }
        
        .card-item {
            padding: 8px 15px;
            background: #050505;
            border-left: 2px solid #1f2937;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #6b7280;
            font-size: 0.85em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        
        .card-item:hover {
            background: #0a0a0a;
            border-left-color: #3b82f6;
            color: #9ca3af;
            padding-left: 20px;
        }
        
        .card-item.current {
            background: linear-gradient(90deg, #3b82f6, transparent);
            border-left-color: #60a5fa;
            color: #fff;
            font-weight: 500;
        }
        
        .card-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .card-status.learned {
            background: #34d399;
        }
        
        .card-status.reviewing {
            background: #fbbf24;
        }
        
        .card-status.new {
            background: #6b7280;
        }
        
        /* Scrollbar for side menu */
        .side-menu::-webkit-scrollbar {
            width: 6px;
        }
        
        .side-menu::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        
        .side-menu::-webkit-scrollbar-thumb {
            background: #1f2937;
            border-radius: 3px;
        }
        
        .side-menu::-webkit-scrollbar-thumb:hover {
            background: #374151;
        }
        
        /* Chat Interface Styles */
        .chat-container {
            display: none;
            background: #111111;
            border: 1px solid #1f2937;
            border-radius: 12px;
            margin-top: 20px;
            overflow: hidden;
            animation: slideIn 0.3s ease;
        }
        
        .chat-container.show {
            display: block;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #1f2937, #374151);
            padding: 15px 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-title {
            color: #60a5fa;
            font-weight: 500;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-title::before {
            content: 'ðŸ’¬';
        }
        
        .chat-close {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .chat-close:hover {
            background: #374151;
            color: #9ca3af;
        }
        
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: #0a0a0a;
        }
        
        .chat-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            animation: messageSlide 0.3s ease;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            flex-shrink: 0;
        }
        
        .message-avatar.user {
            background: #3b82f6;
            color: white;
        }
        
        .message-avatar.ai {
            background: #059669;
            color: white;
        }
        
        .message-content {
            flex: 1;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .message-content.user {
            background: #1e3a8a;
            color: #dbeafe;
            margin-left: auto;
            margin-right: 0;
            max-width: 70%;
        }
        
        .message-content.ai {
            background: #1f2937;
            color: #e5e7eb;
            border: 1px solid #374151;
        }
        
        .message-content.ai.loading {
            background: #1a1a1a;
            color: #6b7280;
            font-style: italic;
        }
        
        .chat-input-container {
            padding: 15px;
            background: #111111;
            border-top: 1px solid #1f2937;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background: #0a0a0a;
            border: 1px solid #1f2937;
            border-radius: 8px;
            color: #fff;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: #111111;
        }
        
        .chat-input::placeholder {
            color: #4b5563;
        }
        
        .chat-send-btn {
            padding: 12px 20px;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .chat-send-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .chat-send-btn:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
        }
        
        .chat-send-btn::after {
            content: 'â†’';
        }
        
        .chat-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .suggestion-chip {
            background: #1f2937;
            border: 1px solid #374151;
            color: #9ca3af;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .suggestion-chip:hover {
            background: #374151;
            border-color: #3b82f6;
            color: #60a5fa;
        }
        
        /* Scrollbar for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        .setup-container {
            background: #111111;
            border: 1px solid #1f2937;
            padding: 40px;
            border-radius: 16px;
            max-width: 450px;
            width: 100%;
        }

        .setup-container h2 {
            color: #3b82f6;
            margin-bottom: 20px;
        }

        .setup-container p {
            color: #9ca3af;
            margin-bottom: 15px;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #1f2937;
            background: #0a0a0a;
            color: #fff;
            font-size: 0.95em;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        @media (max-width: 768px) {
            .side-menu {
                transform: translateX(-240px);
            }
            
            .container {
                margin-left: 60px;
            }
            
            .container.menu-collapsed {
                margin-left: 60px;
            }
        }
        
        @media (max-width: 640px) {
            .header h1 {
                font-size: 2em;
            }
            
            .flashcard-container {
                height: 300px;
            }
            
            .stats-container {
                gap: 10px;
            }
            
            .stat-card {
                min-width: 120px;
                padding: 12px 20px;
            }
            
            .container {
                margin-left: 20px;
                margin-right: 20px;
            }
            
            .menu-toggle {
                right: -30px;
            }
        }
    </style>
</head>
<body>
    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-toggle" onclick="toggleSideMenu()">
            <span id="menuIcon">â—€</span>
        </div>
        <div class="menu-header">
            <div class="menu-title">Study Navigation</div>
            <div class="menu-subtitle">Browse all flashcards</div>
        </div>
        <div class="exam-folder">
            <div class="exam-header" onclick="toggleExam()" id="examHeader">
                <span class="exam-name">Anatomy & Physiology Exam</span>
                <span class="exam-arrow">â–¶</span>
            </div>
            <div class="chapter-list" id="chapterList">
                <!-- Chapters will be dynamically generated here -->
            </div>
        </div>
    </div>
    
    <div class="container" id="mainContainer">
        <div class="header">
            <h1>Helping Liv not Fail This Shit</h1>
            <p>with flash cards that talk back kinda also maybe an algorithm that works?</p>
            <p class="author-credit">by someone who thinks planes are cool</p>
        </div>

        <div id="setup" class="setup-container">
            <h2>Don't share the password cause my computer will break lol</h2>
            <p>Password:</p>
            <input type="password" id="apiKeyInput" class="api-key-input" placeholder="sk-..." />
            <button onclick="saveApiKey()" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Start Studying</button>
            <p style="margin-top: 20px; font-size: 0.85em; color: #6b7280;">idk why I automated talking to you cause kinda also wanna do that but hope this helps</p>
        </div>

        <div id="mainApp" style="display: none; width: 100%;">
            <div class="stats-container">
                <div class="stat-card">
                    <strong>Current Streak</strong>
                    <span id="streak">0</span>
                </div>
                <div class="stat-card">
                    <strong>Cards Learned</strong>
                    <span><span id="learned">0</span>/<span id="total">0</span></span>
                </div>
                <div class="stat-card">
                    <strong>Accuracy</strong>
                    <span id="accuracy">0%</span>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-label">Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="category-selector">
                <div class="custom-dropdown" id="customDropdown">
                    <div class="dropdown-selected" onclick="toggleDropdown()">
                        <span id="selectedText">All Topics</span>
                    </div>
                    <div class="dropdown-options" id="dropdownOptions">
                        <div class="dropdown-option selected" data-value="all" onclick="selectOption('all', 'All Topics')">All Topics</div>
                        <div class="dropdown-option" data-value="chapter1" onclick="selectOption('chapter1', 'Chapter 1: Human Body')">Chapter 1: Human Body</div>
                        <div class="dropdown-option" data-value="chapter2" onclick="selectOption('chapter2', 'Chapter 2: Chemistry')">Chapter 2: Chemistry</div>
                        <div class="dropdown-option" data-value="chapter3" onclick="selectOption('chapter3', 'Chapter 3: Cells')">Chapter 3: Cells</div>
                        <div class="dropdown-option" data-value="chapter4" onclick="selectOption('chapter4', 'Chapter 4: Tissues')">Chapter 4: Tissues</div>
                        <div class="dropdown-option" data-value="chapter5" onclick="selectOption('chapter5', 'Chapter 5: Integumentary')">Chapter 5: Integumentary</div>
                        <div class="dropdown-option" data-value="chapter16" onclick="selectOption('chapter16', 'Chapter 16: Endocrine')">Chapter 16: Endocrine</div>
                    </div>
                </div>
            </div>

            <div class="flashcard-container">
                <div class="flashcard" id="flashcard">
                    <div class="card-face card-front">
                        <div class="card-content" id="questionText"></div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-content" id="answerText"></div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <input type="text" id="userAnswer" class="answer-input" placeholder="Type your answer..." onkeypress="handleKeyPress(event)">
            </div>

            <div class="buttons-container">
                <button onclick="checkAnswer()" class="btn btn-primary">Check Answer</button>
                <button onclick="flipCard()" class="btn btn-secondary">Reveal</button>
                <button onclick="skipCard()" class="btn btn-secondary">Skip</button>
                <button onclick="nextCard()" class="btn btn-success">Next â†’</button>
            </div>

            <div id="feedback"></div>
            
            <div class="chat-container" id="chatContainer">
                <div class="chat-header">
                    <div class="chat-title">Ask for Help</div>
                    <button class="chat-close" onclick="closeChat()">Ã—</button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-suggestions" id="chatSuggestions">
                        <div class="suggestion-chip" onclick="askSuggestion('Can you explain this concept in simpler terms?')">Explain simpler</div>
                        <div class="suggestion-chip" onclick="askSuggestion('What are some memory tricks for this?')">Memory tricks</div>
                        <div class="suggestion-chip" onclick="askSuggestion('Can you give me an example?')">Give example</div>
                        <div class="suggestion-chip" onclick="askSuggestion('What are the key points I should remember?')">Key points</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Ask a question about this topic..." onkeypress="handleChatKeyPress(event)">
                    <button class="chat-send-btn" onclick="sendChatMessage()" id="chatSendBtn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Flashcards data
        const flashcards = [
            // Chapter 1: The Human Body
            {
                category: "chapter1",
                question: "Define anatomy and physiology",
                answer: "Anatomy is the study of the structure of body parts and their relationships. Physiology is the study of the function of body parts and how they work together.",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What is the principle of complementarity?",
                answer: "Structure and function are inseparable - what a structure can do depends on its specific form, and the form of a structure relates to its function.",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "List the 11 organ systems of the body",
                answer: "Integumentary, skeletal, muscular, nervous, endocrine, cardiovascular, lymphatic/immune, respiratory, digestive, urinary, reproductive",
                difficulty: 2
            },
            {
                category: "chapter1",
                question: "What are the requirements for life?",
                answer: "Nutrients, oxygen, water, normal body temperature, and appropriate atmospheric pressure",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "Define homeostasis",
                answer: "The ability to maintain relatively stable internal conditions even when the external environment changes",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "Name the three main parts of a homeostatic control system",
                answer: "Receptor (sensor), control center, and effector",
                difficulty: 2
            },
            {
                category: "chapter1",
                question: "Is blood clotting a positive or negative feedback mechanism?",
                answer: "Positive feedback - the response enhances the original stimulus",
                difficulty: 2
            },
            {
                category: "chapter1",
                question: "Is body temperature regulation a positive or negative feedback mechanism?",
                answer: "Negative feedback - the response reduces or stops the original stimulus",
                difficulty: 2
            },
            {
                category: "chapter1",
                question: "Describe the anatomical position",
                answer: "Standing erect, feet parallel, arms at sides with palms facing forward, head and eyes facing forward",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What does 'superior' mean in anatomical terms?",
                answer: "Toward the head or upper part of a structure (cranial)",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What does 'inferior' mean in anatomical terms?",
                answer: "Away from the head or toward the lower part of a structure (caudal)",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What does 'anterior' mean in anatomical terms?",
                answer: "Toward the front of the body (ventral)",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What does 'posterior' mean in anatomical terms?",
                answer: "Toward the back of the body (dorsal)",
                difficulty: 1
            },
            {
                category: "chapter1",
                question: "What is the function of serous membranes?",
                answer: "To secrete serous fluid that lubricates organs and reduces friction as they move against each other",
                difficulty: 2
            },

            // Chapter 2: Chemistry
            {
                category: "chapter2",
                question: "Define matter and energy",
                answer: "Matter is anything that occupies space and has mass. Energy is the capacity to do work or cause change.",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is potential energy vs kinetic energy?",
                answer: "Potential energy is stored energy (energy of position). Kinetic energy is energy of motion.",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "List the four elements that form the bulk of body matter",
                answer: "Carbon (C), Hydrogen (H), Oxygen (O), and Nitrogen (N)",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "Define molecule",
                answer: "Two or more atoms held together by chemical bonds",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is an ionic bond?",
                answer: "Attraction between two oppositely charged ions formed by transfer of electrons",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is a covalent bond?",
                answer: "Sharing of pairs of electrons between atoms",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is a hydrogen bond?",
                answer: "Attraction between a hydrogen atom with partial positive charge and an electronegative atom with partial negative charge",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "Which type of bond is strongest?",
                answer: "Covalent bonds are the strongest, followed by ionic bonds, then hydrogen bonds (weakest)",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What is pH?",
                answer: "A measure of hydrogen ion concentration in a solution (acidity/alkalinity scale from 0-14)",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is an acid?",
                answer: "A substance that releases hydrogen ions (H+) in solution",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is a base?",
                answer: "A substance that releases hydroxide ions (OH-) or accepts hydrogen ions in solution",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is dehydration synthesis?",
                answer: "A reaction that forms larger molecules from smaller ones by removing water",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What is hydrolysis?",
                answer: "A reaction that breaks down larger molecules into smaller ones by adding water",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "Carbon has how many valence electrons?",
                answer: "Four valence electrons",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "List the four types of macromolecules in cells",
                answer: "Carbohydrates, lipids, proteins, and nucleic acids",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What are the building blocks of carbohydrates?",
                answer: "Monosaccharides (simple sugars)",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What is the major function of carbohydrates?",
                answer: "Primary source of energy for the body",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What monomer is called 'blood sugar'?",
                answer: "Glucose",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What are the building blocks of triglycerides?",
                answer: "One glycerol and three fatty acids",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What type of lipid is a key component of plasma membranes?",
                answer: "Phospholipids",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What molecule is the basis for all steroids in the body?",
                answer: "Cholesterol",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What are the building blocks of proteins?",
                answer: "Amino acids",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What bond joins amino acids together?",
                answer: "Peptide bonds",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What are enzymes?",
                answer: "Proteins that act as biological catalysts to speed up chemical reactions",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What are the building blocks of nucleic acids?",
                answer: "Nucleotides",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "What are the two major types of nucleic acids?",
                answer: "DNA (deoxyribonucleic acid) and RNA (ribonucleic acid)",
                difficulty: 1
            },
            {
                category: "chapter2",
                question: "How does DNA differ from RNA in structure?",
                answer: "DNA is double-stranded with deoxyribose sugar and thymine; RNA is single-stranded with ribose sugar and uracil instead of thymine",
                difficulty: 2
            },
            {
                category: "chapter2",
                question: "What is ATP?",
                answer: "Adenosine triphosphate - the primary energy currency of cells",
                difficulty: 1
            },

            // Chapter 3: Cells
            {
                category: "chapter3",
                question: "Define cell",
                answer: "The basic structural and functional unit of life",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "List the three major regions of a generalized cell",
                answer: "Plasma membrane, cytoplasm, and nucleus",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is the chemical composition of the plasma membrane?",
                answer: "Phospholipid bilayer with embedded proteins and cholesterol",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What type of junction prevents molecules from passing between cells?",
                answer: "Tight junctions",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What type of junction anchors cells together?",
                answer: "Desmosomes",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What type of junction allows ions to pass between cells?",
                answer: "Gap junctions",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What is simple diffusion?",
                answer: "Movement of molecules from high to low concentration without energy or transport proteins",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is facilitated diffusion?",
                answer: "Movement of molecules from high to low concentration using transport proteins but no energy",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What is osmosis?",
                answer: "Movement of water across a semipermeable membrane from low to high solute concentration",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is the main difference between passive and active transport?",
                answer: "Passive transport doesn't require energy; active transport requires ATP",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is primary active transport?",
                answer: "Direct use of ATP to move substances against concentration gradient",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What is secondary active transport?",
                answer: "Uses energy from ion gradients created by primary active transport",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What is endocytosis?",
                answer: "Process of bringing materials into cell using vesicles",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is exocytosis?",
                answer: "Process of releasing materials from cell using vesicles",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is the function of mitochondria?",
                answer: "Generate ATP through cellular respiration (powerhouse of cell)",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What are cristae?",
                answer: "Inner folds of mitochondrial membrane that increase surface area for ATP production",
                difficulty: 2
            },
            {
                category: "chapter3",
                question: "What is the function of ribosomes?",
                answer: "Protein synthesis",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is the function of the Golgi apparatus?",
                answer: "Modifies, packages, and ships proteins from the ER",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What is the function of lysosomes?",
                answer: "Digest cellular waste and foreign substances using enzymes",
                difficulty: 1
            },
            {
                category: "chapter3",
                question: "What are the phases of the cell cycle?",
                answer: "Interphase (G1, S, G2) and M phase (mitosis and cytokinesis)",
                difficulty: 2
            },

            // Chapter 4: Tissues
            {
                category: "chapter4",
                question: "Define gland",
                answer: "One or more cells that secrete a particular product",
                difficulty: 1
            },
            {
                category: "chapter4",
                question: "What is the difference between exocrine and endocrine glands?",
                answer: "Exocrine glands secrete onto body surfaces or into body cavities via ducts; endocrine glands secrete hormones directly into blood",
                difficulty: 2
            },
            {
                category: "chapter4",
                question: "List the four main types of tissues",
                answer: "Epithelial, connective, muscle, and nervous tissue",
                difficulty: 1
            },
            {
                category: "chapter4",
                question: "What are five major functions of connective tissue?",
                answer: "Binding and support, protection, insulation, storage, and transportation",
                difficulty: 2
            },
            {
                category: "chapter4",
                question: "Name the three types of muscle tissue",
                answer: "Skeletal muscle, cardiac muscle, and smooth muscle",
                difficulty: 1
            },
            {
                category: "chapter4",
                question: "What distinguishes skeletal muscle microscopically?",
                answer: "Striated appearance and multiple nuclei per cell",
                difficulty: 2
            },
            {
                category: "chapter4",
                question: "What distinguishes cardiac muscle microscopically?",
                answer: "Striated with intercalated discs and single nucleus per cell",
                difficulty: 2
            },
            {
                category: "chapter4",
                question: "What distinguishes smooth muscle microscopically?",
                answer: "No striations and single nucleus per cell",
                difficulty: 2
            },
            {
                category: "chapter4",
                question: "What are the two main cell types in nervous tissue?",
                answer: "Neurons and neuroglia (glial cells)",
                difficulty: 1
            },
            {
                category: "chapter4",
                question: "What are the three main steps of tissue repair?",
                answer: "Inflammation, organization (granulation tissue formation), and regeneration/fibrosis",
                difficulty: 2
            },

            // Chapter 5: Integumentary System
            {
                category: "chapter5",
                question: "List the two layers of skin",
                answer: "Epidermis and dermis",
                difficulty: 1
            },
            {
                category: "chapter5",
                question: "What tissue type composes the epidermis?",
                answer: "Stratified squamous epithelium",
                difficulty: 1
            },
            {
                category: "chapter5",
                question: "List the layers of epidermis from deep to superficial",
                answer: "Stratum basale, stratum spinosum, stratum granulosum, stratum lucidum (thick skin only), stratum corneum",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "Which epidermal layer is only found in thick skin?",
                answer: "Stratum lucidum",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "Where does keratinization begin?",
                answer: "Stratum granulosum",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "What pigment provides natural sunscreen?",
                answer: "Melanin",
                difficulty: 1
            },
            {
                category: "chapter5",
                question: "Which cells produce melanin?",
                answer: "Melanocytes",
                difficulty: 1
            },
            {
                category: "chapter5",
                question: "What yellow-orange pigment accumulates in stratum corneum?",
                answer: "Carotene",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "What pigment in red blood cells affects skin color?",
                answer: "Hemoglobin",
                difficulty: 1
            },
            {
                category: "chapter5",
                question: "What tissue types compose the dermis?",
                answer: "Dense irregular connective tissue",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "Compare eccrine and apocrine glands",
                answer: "Eccrine: most abundant, watery sweat, thermoregulation. Apocrine: axillary/genital regions, milky sweat, activated at puberty",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "List at least five functions of skin",
                answer: "Protection, temperature regulation, sensation, metabolic functions (vitamin D), excretion, blood reservoir",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "How does skin help regulate body temperature?",
                answer: "Sweating for cooling and blood vessel dilation/constriction to control heat loss",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "What do free nerve endings detect?",
                answer: "Pain, temperature, and itch",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "What do Meissner's corpuscles detect?",
                answer: "Light touch",
                difficulty: 2
            },
            {
                category: "chapter5",
                question: "What do Pacinian corpuscles detect?",
                answer: "Deep pressure and vibration",
                difficulty: 2
            },

            // Chapter 16: Endocrine System
            {
                category: "chapter16",
                question: "How do hormonal and neural controls differ?",
                answer: "Hormonal: slower, longer-lasting, widespread effects via bloodstream. Neural: faster, shorter-duration, targeted effects via nerves",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "List major endocrine organs",
                answer: "Pituitary, thyroid, parathyroid, adrenal glands, pancreas, pineal gland, gonads (ovaries/testes)",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "Which organelle synthesizes steroid hormones?",
                answer: "Smooth endoplasmic reticulum",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "How do lipid-soluble hormones work?",
                answer: "Cross plasma membrane, bind to intracellular receptors, directly affect gene transcription",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "How do water-soluble hormones work?",
                answer: "Bind to membrane receptors, activate second messenger systems",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What are the three types of hormone stimuli?",
                answer: "Humoral (blood chemistry), neural (nerve impulses), and hormonal (other hormones)",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is the trigger for insulin release?",
                answer: "High blood glucose (humoral stimulus)",
                difficulty: 1
            },
            {
                category: "chapter16",
                question: "What is the trigger for parathyroid hormone release?",
                answer: "Low blood calcium (humoral stimulus)",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is antagonism in hormone interactions?",
                answer: "One hormone opposes the action of another hormone",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is synergism in hormone interactions?",
                answer: "Multiple hormones produce same effect and their combined effects are amplified",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is permissiveness in hormone interactions?",
                answer: "One hormone cannot exert full effects without another hormone being present",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What two hormones does the posterior pituitary release?",
                answer: "Oxytocin and ADH (antidiuretic hormone/vasopressin)",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "List anterior pituitary hormones",
                answer: "Growth hormone (GH), prolactin (PRL), ACTH, TSH, FSH, LH",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What are the two groups of thyroid hormones?",
                answer: "Thyroid hormone (T3/T4) and calcitonin",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is the major effect of PTH?",
                answer: "Increases blood calcium levels",
                difficulty: 1
            },
            {
                category: "chapter16",
                question: "How are insulin and glucagon antagonistic?",
                answer: "Insulin lowers blood glucose; glucagon raises blood glucose",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What is the function of testosterone?",
                answer: "Development and maintenance of male reproductive structures and secondary sex characteristics",
                difficulty: 2
            },
            {
                category: "chapter16",
                question: "What hormones do the ovaries produce?",
                answer: "Estrogen and progesterone",
                difficulty: 1
            },
            {
                category: "chapter16",
                question: "What is the function of melatonin?",
                answer: "Regulates circadian rhythm (sleep-wake cycle)",
                difficulty: 1
            }
        ];

        // Spaced repetition algorithm data
        let cardData = {};
        let currentCard = null;
        let currentIndex = 0;
        let apiKey = '';
        let correctCount = 0;
        let totalAttempts = 0;
        let currentStreak = 0;
        let filteredCards = [];

        // Initialize card data with spaced repetition info
        function initializeCardData() {
            flashcards.forEach((card, index) => {
                if (!cardData[index]) {
                    cardData[index] = {
                        interval: 1,
                        easeFactor: 2.5,
                        nextReview: Date.now(),
                        repetitions: 0,
                        correctStreak: 0
                    };
                }
            });
            
            // Load from localStorage if exists
            const saved = localStorage.getItem('cardData');
            if (saved) {
                cardData = JSON.parse(saved);
            }
        }

        // Save API key and start app
        function saveApiKey() {
            apiKey = document.getElementById('apiKeyInput').value;
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
                document.getElementById('setup').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                initializeApp();
                buildSideMenu();
            } else {
                alert('Please enter your API key');
            }
        }

        // Initialize the app
        function initializeApp() {
            apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                document.getElementById('setup').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                return;
            }
            
            initializeCardData();
            filteredCards = [...flashcards];
            updateStats();
            loadNextCard();
        }

        // Spaced repetition algorithm
        function updateCardAfterReview(cardIndex, correct) {
            const data = cardData[cardIndex];
            
            if (correct) {
                data.correctStreak++;
                data.repetitions++;
                
                if (data.correctStreak === 1) {
                    data.interval = 1;
                } else if (data.correctStreak === 2) {
                    data.interval = 6;
                } else {
                    data.interval = Math.round(data.interval * data.easeFactor);
                }
                
                data.easeFactor = Math.min(2.5, data.easeFactor + 0.1);
                currentStreak++;
            } else {
                data.correctStreak = 0;
                data.interval = 1;
                data.easeFactor = Math.max(1.3, data.easeFactor - 0.2);
                currentStreak = 0;
            }
            
            data.nextReview = Date.now() + (data.interval * 24 * 60 * 60 * 1000);
            
            localStorage.setItem('cardData', JSON.stringify(cardData));
        }

        // Get cards for review
        function getCardsForReview() {
            const now = Date.now();
            const category = currentCategory;
            
            let cards = flashcards.map((card, index) => ({
                ...card,
                index,
                data: cardData[index]
            }));
            
            if (category !== 'all') {
                cards = cards.filter(card => card.category === category);
            }
            
            // Sort by review priority
            cards.sort((a, b) => {
                const aDue = a.data.nextReview <= now;
                const bDue = b.data.nextReview <= now;
                
                if (aDue && !bDue) return -1;
                if (!aDue && bDue) return 1;
                
                return a.data.interval - b.data.interval;
            });
            
            return cards;
        }

        // Load next card
        function loadNextCard() {
            const cards = getCardsForReview();
            if (cards.length === 0) {
                alert("Great job! You've reviewed all cards!");
                return;
            }
            
            currentCard = cards[0];
            currentIndex = currentCard.index;
            
            document.getElementById('questionText').textContent = currentCard.question;
            document.getElementById('answerText').textContent = currentCard.answer;
            document.getElementById('userAnswer').value = '';
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('flashcard').classList.remove('flipped');
            
            updateStats();
            updateCurrentCardHighlight();
        }

        // Update statistics
        function updateStats() {
            const learned = Object.values(cardData).filter(d => d.correctStreak >= 3).length;
            const total = flashcards.length;
            const accuracy = totalAttempts > 0 ? Math.round((correctCount / totalAttempts) * 100) : 0;
            
            document.getElementById('streak').textContent = currentStreak;
            document.getElementById('learned').textContent = learned;
            document.getElementById('total').textContent = total;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const progress = Math.round((learned / total) * 100);
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Flip card
        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        // Check answer using OpenAI
        async function checkAnswer() {
            const userAnswer = document.getElementById('userAnswer').value.trim();
            if (!userAnswer) {
                alert('Please enter an answer!');
                return;
            }
            
            // Store the student's answer for chat context
            lastStudentAnswer = userAnswer;
            
            totalAttempts++;
            flipCard();
            
            const feedbackDiv = document.getElementById('feedback');
            feedbackDiv.innerHTML = 'Checking your answer...';
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a study helper. Compare the student answer to the correct answer. Reply ONLY with: "Correct!" if functionally correct, or "Not quite. and 1-4 sentences about what was missing/wrong you are a tutor here talking to the student". Be strict but fair - key concepts must be present.'
                            },
                            {
                                role: 'user',
                                content: `Question: ${currentCard.question}\nCorrect Answer: ${currentCard.answer}\nStudent Answer: ${userAnswer}`
                            }
                        ],
                        max_tokens: 50,
                        temperature: 0.3
                    })
                });
                
                const data = await response.json();
                const feedback = data.choices[0].message.content;
                const isCorrect = feedback.toLowerCase().includes('correct!');
                
                feedbackDiv.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackDiv.innerHTML = `<strong>${feedback}</strong>`;
                
                if (isCorrect) {
                    correctCount++;
                } else {
                    // Show chat interface for incorrect answers
                    showChat();
                }
                
                updateCardAfterReview(currentIndex, isCorrect);
                updateStats();
                
            } catch (error) {
                console.error('Error:', error);
                // Fallback to simple comparison if API fails
                const isCorrect = userAnswer.toLowerCase().includes(currentCard.answer.toLowerCase().substring(0, 20));
                feedbackDiv.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackDiv.innerHTML = isCorrect ? '<strong>Correct!</strong>' : '<strong>Not quite. Check the answer and try again!</strong>';
                
                if (isCorrect) {
                    correctCount++;
                } else {
                    // Show chat interface for incorrect answers
                    showChat();
                }
                
                updateCardAfterReview(currentIndex, isCorrect);
                updateStats();
            }
        }

        // Next card
        function nextCard() {
            closeChat(); // Close chat when moving to next card
            loadNextCard();
        }

        // Skip card
        function skipCard() {
            closeChat(); // Close chat when skipping
            updateCardAfterReview(currentIndex, false); // Mark as incorrect
            updateStats();
            loadNextCard();
        }

        // Handle enter key
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        }

        // Custom dropdown functionality
        let currentCategory = 'all';
        
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownOptions');
            const selected = document.querySelector('.dropdown-selected');
            
            dropdown.classList.toggle('show');
            selected.classList.toggle('open');
        }
        
        function selectOption(value, text) {
            currentCategory = value;
            document.getElementById('selectedText').textContent = text;
            
            // Update selected state
            document.querySelectorAll('.dropdown-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-value="${value}"]`).classList.add('selected');
            
            // Close dropdown
            document.getElementById('dropdownOptions').classList.remove('show');
            document.querySelector('.dropdown-selected').classList.remove('open');
            
            // Load next card with new category
            loadNextCard();
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customDropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                document.getElementById('dropdownOptions').classList.remove('show');
                document.querySelector('.dropdown-selected').classList.remove('open');
            }
        });

        // Change category (updated for custom dropdown)
        function changeCategory() {
            loadNextCard();
        }

        // Chat Functions
        let chatHistory = [];
        let lastStudentAnswer = '';
        
        function showChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.add('show');
            
            // Initialize chat with context about the current question
            if (chatHistory.length === 0) {
                const studentAnswerText = lastStudentAnswer ? ` You answered: "${lastStudentAnswer}".` : '';
                addChatMessage('ai', `I see you're having trouble with this question about "${currentCard.question}".${studentAnswerText} The correct answer is: "${currentCard.answer}". How can I help you understand this better?`);
            }
        }
        
        function closeChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.remove('show');
            chatHistory = [];
            lastStudentAnswer = ''; // Clear the student's answer
            document.getElementById('chatMessages').innerHTML = `
                <div class="chat-suggestions" id="chatSuggestions">
                    <div class="suggestion-chip" onclick="askSuggestion('Can you explain this concept in simpler terms?')">Explain simpler</div>
                    <div class="suggestion-chip" onclick="askSuggestion('What are some memory tricks for this?')">Memory tricks</div>
                    <div class="suggestion-chip" onclick="askSuggestion('Can you give me an example?')">Give example</div>
                    <div class="suggestion-chip" onclick="askSuggestion('What are the key points I should remember?')">Key points</div>
                </div>
            `;
        }
        
        function addChatMessage(sender, message, isLoading = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            const avatar = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
            const loadingClass = isLoading ? ' loading' : '';
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${sender}">${avatar}</div>
                <div class="message-content ${sender}${loadingClass}">${message}</div>
            `;
            
            // Remove suggestions after first message
            const suggestions = document.getElementById('chatSuggestions');
            if (suggestions && chatHistory.length > 0) {
                suggestions.remove();
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return messageDiv;
        }
        
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            chatHistory.push({ role: 'user', content: message });
            input.value = '';
            
            // Show loading message
            const loadingMessage = addChatMessage('ai', 'Thinking...', true);
            
            // Disable send button
            const sendBtn = document.getElementById('chatSendBtn');
            sendBtn.disabled = true;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a helpful tutor. The student is studying flashcards and got this question wrong:
                                
                                Question: "${currentCard.question}"
                                Student's Answer: "${lastStudentAnswer}"
                                Correct Answer: "${currentCard.answer}"
                                
                                Help them understand the concept better. Be encouraging, clear, and educational. Address any misconceptions in their answer. Provide examples, memory tricks, or simplified explanations when helpful. Keep responses concise but informative (2-4 sentences usually).`
                            },
                            ...chatHistory
                        ],
                        max_tokens: 200,
                        temperature: 0.7
                    })
                });
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // Remove loading message
                loadingMessage.remove();
                
                // Add AI response
                addChatMessage('ai', aiResponse);
                chatHistory.push({ role: 'assistant', content: aiResponse });
                
            } catch (error) {
                console.error('Chat error:', error);
                loadingMessage.querySelector('.message-content').textContent = 'Sorry, I had trouble responding. Please try again.';
                loadingMessage.querySelector('.message-content').classList.remove('loading');
            }
            
            // Re-enable send button
            sendBtn.disabled = false;
        }
        
        function askSuggestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        // Side Menu Functions
        function toggleSideMenu() {
            const menu = document.getElementById('sideMenu');
            const container = document.getElementById('mainContainer');
            const icon = document.getElementById('menuIcon');
            
            menu.classList.toggle('collapsed');
            container.classList.toggle('menu-collapsed');
            
            if (menu.classList.contains('collapsed')) {
                icon.textContent = 'â–¶';
            } else {
                icon.textContent = 'â—€';
            }
        }
        
        function toggleExam() {
            const examHeader = document.getElementById('examHeader');
            const chapterList = document.getElementById('chapterList');
            
            examHeader.classList.toggle('active');
            chapterList.classList.toggle('open');
        }
        
        function toggleChapter(chapterId) {
            const chapterHeader = document.getElementById(`chapter-header-${chapterId}`);
            const cardList = document.getElementById(`card-list-${chapterId}`);
            
            // Close all other chapters
            document.querySelectorAll('.chapter-header').forEach(header => {
                if (header.id !== `chapter-header-${chapterId}`) {
                    header.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.card-list').forEach(list => {
                if (list.id !== `card-list-${chapterId}`) {
                    list.classList.remove('open');
                }
            });
            
            chapterHeader.classList.toggle('active');
            cardList.classList.toggle('open');
        }
        
        function goToCard(cardIndex) {
            closeChat(); // Close chat when navigating to specific card
            currentIndex = cardIndex;
            currentCard = flashcards[cardIndex];
            
            document.getElementById('questionText').textContent = currentCard.question;
            document.getElementById('answerText').textContent = currentCard.answer;
            document.getElementById('userAnswer').value = '';
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('flashcard').classList.remove('flipped');
            
            updateStats();
            updateCurrentCardHighlight();
        }
        
        function updateCurrentCardHighlight() {
            // Remove all current highlights
            document.querySelectorAll('.card-item').forEach(item => {
                item.classList.remove('current');
            });
            
            // Add current highlight
            const currentCardElement = document.getElementById(`card-${currentIndex}`);
            if (currentCardElement) {
                currentCardElement.classList.add('current');
            }
        }
        
        function buildSideMenu() {
            const chapters = {
                'chapter1': { name: 'Chapter 1: Human Body', cards: [] },
                'chapter2': { name: 'Chapter 2: Chemistry', cards: [] },
                'chapter3': { name: 'Chapter 3: Cells', cards: [] },
                'chapter4': { name: 'Chapter 4: Tissues', cards: [] },
                'chapter5': { name: 'Chapter 5: Integumentary', cards: [] },
                'chapter16': { name: 'Chapter 16: Endocrine', cards: [] }
            };
            
            // Group cards by chapter
            flashcards.forEach((card, index) => {
                if (chapters[card.category]) {
                    chapters[card.category].cards.push({ ...card, index });
                }
            });
            
            let menuHTML = '';
            
            Object.keys(chapters).forEach(chapterId => {
                const chapter = chapters[chapterId];
                if (chapter.cards.length === 0) return;
                
                menuHTML += `
                    <div class="chapter-folder">
                        <div class="chapter-header" id="chapter-header-${chapterId}" onclick="toggleChapter('${chapterId}')">
                            <span class="chapter-name">${chapter.name}</span>
                            <span class="chapter-count">${chapter.cards.length}</span>
                            <span class="chapter-arrow">â–¶</span>
                        </div>
                        <div class="card-list" id="card-list-${chapterId}">
                `;
                
                chapter.cards.forEach(card => {
                    const data = cardData[card.index];
                    let statusClass = 'new';
                    if (data && data.correctStreak >= 3) {
                        statusClass = 'learned';
                    } else if (data && data.repetitions > 0) {
                        statusClass = 'reviewing';
                    }
                    
                    const truncatedQuestion = card.question.length > 35 
                        ? card.question.substring(0, 35) + '...' 
                        : card.question;
                    
                    menuHTML += `
                        <div class="card-item" id="card-${card.index}" onclick="goToCard(${card.index})">
                            <span class="card-status ${statusClass}"></span>
                            ${truncatedQuestion}
                        </div>
                    `;
                });
                
                menuHTML += `
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('chapterList').innerHTML = menuHTML;
        }

        // Initialize on load
        window.onload = function() {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('setup').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                initializeApp();
                buildSideMenu();
            }
        };
    </script>
</body>
</html>